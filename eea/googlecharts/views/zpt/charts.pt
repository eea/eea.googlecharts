<tal:tabs repeat="tab view/tabs">
  <div class="daviz-tab-view eea-googlecharts-charts"
    tal:attributes="id string:tab-${tab/name}"></div>
</tal:tabs>

<script type="text/javascript" src="https://www.google.com/jsapi"></script>

<script type="text/javascript">
    google.load('visualization', '1.0', {packages: ['controls']});
    googlechart_config_array = [];
    var has_dashboard = false;
</script>

<script type="text/javascript" tal:content="string:available_columns = ${view/get_columns};merged_rows = ${view/get_rows}; baseurl = '${view/context/absolute_url}';">
</script>
<div class="googlecharts_container">
<tal:block tal:define="charts view/get_charts; has_dashboard view/has_dashboard">
    <tal:block tal:condition="has_dashboard">
        <script type="text/javascript" tal:content="string: var googledashboard_filters=${view/get_dashboard_filters}">
        </script>
        <script type="text/javascript">
            has_dashboard = true;
        </script>
    </tal:block>

    <tal:block tal:repeat="chart charts">
        <script type="text/javascript"
            tal:define="dashboard python:view.get_dashboard_js(chart);"
            tal:content="string: googlechart_config_array.push(['${chart/id}', ${chart/config}, ${chart/columns}, ${chart/filters}, ${chart/width}, ${chart/height}, ${chart/filterposition}, ${chart/options}, $dashboard]);"></script>
    </tal:block>
    <div style="clear:both">
    </div>

    <div class="google_buttons_bar">
        <input id="googlechart_embed_button" style="display:none;" type="button" value="embed" onClick="showEmbed();" class="context" />
        <input id="googlechart_export_button" style="display:none;" type="button" value="export to png" onClick="exportToPng();" class="context" />
    </div>


    <div id="googlechart_dashboard">
        <div style="clear:both"></div>
    </div>

    <form id="export" action='@@googlechart.export' method="POST">
        <input type="hidden" id="svg" name="svg"/>
        <input type="hidden" id="filename" name="filename"/>
        <input type="hidden" id="type" name="type"/>
        <input type="hidden" id="width" name="width"/>
    </form>

</tal:block>
</div>
